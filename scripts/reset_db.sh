#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è —Å–±—Ä–æ—Å–∞ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö AILLM
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
PROJECT_ROOT="$(cd "$SCRIPT_DIR/.." && pwd)"

cd "$PROJECT_ROOT"

echo "=========================================="
echo "üóëÔ∏è  –°–±—Ä–æ—Å –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö AILLM"
echo "=========================================="
echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–ø—É—â–µ–Ω –ª–∏ –ø—Ä–æ–µ–∫—Ç
if [ -f "backend.pid" ]; then
    PID=$(cat backend.pid 2>/dev/null || echo "")
    if [ -n "$PID" ] && kill -0 "$PID" 2>/dev/null; then
        echo "‚ùå Backend –∑–∞–ø—É—â–µ–Ω (PID: $PID)"
        echo "   –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç –ø–µ—Ä–µ–¥ —Å–±—Ä–æ—Å–æ–º: ./stop.sh"
        exit 1
    fi
fi

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —á—Ç–æ –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–æ
echo "üìÅ –ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ memory/:"
if [ -d "memory" ]; then
    ls -lh memory/*.db 2>/dev/null || echo "   (–ø—É—Å—Ç–æ)"
    echo ""
    
    # –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
    read -p "‚ö†Ô∏è  –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö? [y/N] " -n 1 -r
    echo ""
    
    if [[ $REPLY =~ ^[Yy]$ ]]; then
        echo ""
        echo "üóëÔ∏è  –£–¥–∞–ª–µ–Ω–∏–µ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö..."
        
        # –£–¥–∞–ª—è–µ–º SQLite —Ñ–∞–π–ª—ã –∏ WAL/SHM
        rm -f memory/*.db memory/*.db-shm memory/*.db-wal 2>/dev/null || true
        
        echo "‚úÖ memories.db     —É–¥–∞–ª–µ–Ω–∞"
        echo "‚úÖ learning.db     —É–¥–∞–ª–µ–Ω–∞"
        echo "‚úÖ feedback.db     —É–¥–∞–ª–µ–Ω–∞"
        echo "‚úÖ model_metrics.db —É–¥–∞–ª–µ–Ω–∞"
        
        echo ""
        echo "=========================================="
        echo "‚úÖ –ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å–±—Ä–æ—à–µ–Ω—ã"
        echo "=========================================="
        echo ""
        echo "üí° –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—É—Å–∫–µ –ø—Ä–æ–µ–∫—Ç–∞ –±–∞–∑—ã –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã –∑–∞–Ω–æ–≤–æ"
    else
        echo "‚ùå –û—Ç–º–µ–Ω–µ–Ω–æ"
        exit 0
    fi
else
    echo "‚ö†Ô∏è  –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è memory/ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
fi

