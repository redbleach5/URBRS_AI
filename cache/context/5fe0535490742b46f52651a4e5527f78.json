{"value": "    return allUsers.filter(u => \n      !currentUserIds.includes(u.id) && \n      u.id !== user?.id &&\n      u.id !== currentFolder.owner_id\n    );\n  };\n\n  const formatSize = (bytes: number) => {\n    if (bytes === 0) return '0 B';\n    const k = 1024;\n    const sizes = ['B', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];\n  };\n\n  const getFolderType = (folder: SharedFolder): 'owned' | 'accessible' | 'public' => {\n    if (folder.owner_id === user?.id) return 'owned';\n    if (folder.is_public) return 'public';\n    return 'accessible';\n  };\n\n  const getFolderTypeLabel = (folder: SharedFolder) => {\n    const type = getFolderType(folder);\n    switch (type) {\n      case 'owned':\n        return { label: '\u041c\u043e\u044f \u043f\u0430\u043f\u043a\u0430', icon: Folder, color: 'text-blue-600' };\n      case 'accessible':\n        return { label: '\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u0430 \u043c\u043d\u0435', icon: Users, color: 'text-green-600' };\n      case 'public':\n        return { label: '\u041f\u0443\u0431\u043b\u0438\u0447\u043d\u0430\u044f', icon: Globe, color: 'text-purple-600' };\n    }\n  };\n\n  // \u0417\u0430\u043a\u0440\u044b\u0442\u0438\u0435 \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442\u043d\u043e\u0433\u043e \u043c\u0435\u043d\u044e\n  useEffect(() => {\n    const handleClickOutside = (e: MouseEvent) => {\n      const target = e.target as HTMLElement;\n      const contextMenuElement = document.querySelector('.context-menu-container');\n      \n      if (contextMenuElement && !contextMenuElement.contains(target)) {\n        setContextMenu(null);\n      }\n    };\n\n    const handleEscape = (e: KeyboardEvent) => {\n      if (e.key === 'Escape') {\n        setContextMenu(null);\n      }\n    };\n\n    if (contextMenu) {\n      const timeoutId = setTimeout(() => {\n        document.addEventListener('click', handleClickOutside);\n      }, 100);\n      \n      document.addEventListener('keydown', handleEscape);\n      \n      return () => {\n        clearTimeout(timeoutId);\n        document.removeEventListener('click', handleClickOutside);\n        document.removeEventListener('keydown', handleEscape);\n      };\n    }\n  }, [contextMenu]);\n\n\n};\n\nconst formatFileDateTime = (dateString: string): string => {\n  // \u0415\u0441\u043b\u0438 \u0441\u0442\u0440\u043e\u043a\u0430 \u0443\u0436\u0435 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 'Z' \u0438\u043b\u0438 '+', \u0437\u043d\u0430\u0447\u0438\u0442 \u044d\u0442\u043e \u0443\u0436\u0435 UTC \u0438\u043b\u0438 \u0441 \u0447\u0430\u0441\u043e\u0432\u044b\u043c \u043f\u043e\u044f\u0441\u043e\u043c\n  if (dateString.includes('Z') || dateString.includes('+') || dateString.includes('-', 10)) {\n    return new Date(dateString).toLocaleString('ru-RU', { \n      timeZone: 'Europe/Moscow',\n      year: 'numeric',\n      month: '2-digit',\n      day: '2-digit',\n      hour: '2-digit',\n      minute: '2-digit',\n      second: '2-digit',\n      hour12: false\n    });\n  }\n  // \u0418\u043d\u0430\u0447\u0435 \u0438\u043d\u0442\u0435\u0440\u043f\u0440\u0435\u0442\u0438\u0440\u0443\u0435\u043c \u043a\u0430\u043a UTC (\u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c 'Z') \u0438 \u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0438\u0440\u0443\u0435\u043c \u0432 \u043c\u043e\u0441\u043a\u043e\u0432\u0441\u043a\u043e\u0435 \u0432\u0440\u0435\u043c\u044f\n  const utcDate = new Date(dateString + 'Z');\n  return utcDate.toLocaleString('ru-RU', { \n    timeZone: 'Europe/Moscow',\n    year: 'numeric',\n    month: '2-digit',\n    day: '2-digit',\n    hour: '2-digit',\n    minute: '2-digit',\n    second: '2-digit',\n    hour12: false\n  });\n};\n\ntype SortField = 'name' | 'size' | 'created_at' | 'type';\ntype SortOrder = 'asc' | 'desc';\n\nconst FileManager: React.FC = () => {\n  const { user } = useAuth();\n  const location = useLocation();\n  const navigate = useNavigate();\n  const params = useParams<{ id?: string }>();\n  const [files, setFiles] = useState<FileItem[]>([]);\n  const [currentPath, setCurrentPath] = useState<number[]>([]);\n  const [sharedFolderId, setSharedFolderId] = useState<number | null>(null);\n  const [sharedFolderName, setSharedFolderName] = useState<string | null>(null);\n  const [sharedFolderPermission, setSharedFolderPermission] = useState<'owner' | 'write' | 'read' | null>(null);\n  const [selectedFiles, setSelectedFiles] = useState<Set<number>>(new Set());\n  const [viewMode, setViewMode] = useState<'grid' | 'list'>('grid');\n  const [searchQuery, setSearchQuery] = useState('');\n  const [searchResults, setSearchResults] = useState<FileItem[]>([]);\n  const [isSearching, setIsSearching] = useState(false);\n  const [sortField, setSortField] = useState<SortField>('name');\n  const [sortOrder, setSortOrder] = useState<SortOrder>('asc');\n\n    return allUsers.filter(u => \n      !currentUserIds.includes(u.id) && \n      u.id !== user?.id &&\n      u.id !== currentFolder.owner_id\n    );\n  };\n\n  const formatSize = (bytes: number) => {\n    if (bytes === 0) return '0 B';\n    const k = 1024;\n    const sizes = ['B', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];\n  };\n\n  const getFolderType = (folder: SharedFolder): 'owned' | 'accessible' | 'public' => {\n    if (folder.owner_id === user?.id) return 'owned';\n    if (folder.is_public) return 'public';\n    return 'accessible';\n  };\n\n  const getFolderTypeLabel = (folder: SharedFolder) => {\n    const type = getFolderType(folder);\n    switch (type) {\n      case 'owned':\n        return { label: '\u041c\u043e\u044f \u043f\u0430\u043f\u043a\u0430', icon: Folder, color: 'text-blue-600' };\n      case 'accessible':\n        return { label: '\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u0430 \u043c\u043d\u0435', icon: Users, color: 'text-green-600' };\n      case 'public':\n        return { label: '\u041f\u0443\u0431\u043b\u0438\u0447\u043d\u0430\u044f', icon: Globe, color: 'text-purple-600' };\n    }\n  };\n\n  // \u0417\u0430\u043a\u0440\u044b\u0442\u0438\u0435 \u043a\u043e\u043d\u0442\u0435\u043a\u0441\u0442\u043d\u043e\u0433\u043e \u043c\u0435\u043d\u044e\n  useEffect(() => {\n    const handleClickOutside = (e: MouseEvent) => {\n      const target = e.target as HTMLElement;\n      const contextMenuElement = document.querySelector('.context-menu-container');\n      \n      if (contextMenuElement && !contextMenuElement.contains(target)) {\n        setContextMenu(null);\n      }\n    };\n\n    const handleEscape = (e: KeyboardEvent) => {\n      if (e.key === 'Escape') {\n        setContextMenu(null);\n      }\n    };\n\n    if (contextMenu) {\n      const timeoutId = setTimeout(() => {\n        document.addEventListener('click', handleClickOutside);\n      }, 100);\n      \n      document.addEventListener('keydown', handleEscape);\n      \n      return () => {\n        clearTimeout(timeoutId);\n        document.removeEventListener('click', handleClickOutside);\n        document.removeEventListener('keydown', handleEscape);\n      };\n    }\n  }, [contextMenu]);\n", "timestamp": 1767395320.3714392, "ttl": 3600}